<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="AzureAppRegistrationsManager.WinUI.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:AzureAppRegistrationsManager.WinUI"
    xmlns:converters="using:AzureAppRegistrationsManager.WinUI.Converters"
    xmlns:features_overview="using:AzureAppRegistrationsManager.WinUI.Features.Overview"
    xmlns:features_authentication="using:AzureAppRegistrationsManager.WinUI.Features.Authentication"
    xmlns:features_apipermissions="using:AzureAppRegistrationsManager.WinUI.Features.ApiPermissions"
    xmlns:features_scope="using:AzureAppRegistrationsManager.WinUI.Features.Scope"
    xmlns:features_role="using:AzureAppRegistrationsManager.WinUI.Features.Role"
    xmlns:features_CertificatesAndSecrets="using:AzureAppRegistrationsManager.WinUI.Features.CertificatesAndSecrets"
    xmlns:features_Owners="using:AzureAppRegistrationsManager.WinUI.Features.Owners"
    xmlns:features_manifest="using:AzureAppRegistrationsManager.WinUI.Features.Manifest"
    xmlns:scope="using:AzureAppRegistrationsManager.WinUI.Features.Scope"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls" 
    xmlns:monaco="using:Monaco"
    xmlns:graph="using:Microsoft.Graph.Models"
    mc:Ignorable="d"
    Title="Azure App Registrations Manager">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid 
        RowDefinitions="Auto,Auto,*" 
        Padding="20"
        Loaded="MainGrid_Loaded"
        x:Name="MainGrid">

        <StackPanel Grid.Row="0" Orientation="Vertical">
            <StackPanel HorizontalAlignment="Left" Orientation="Horizontal" Spacing="20">
                <Button
                    x:Name="RefreshButton"
                    Click="RefreshButton_Click">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <SymbolIcon Symbol="Refresh"/>
                        <TextBlock Text="Refresh Own Applications"/>
                    </StackPanel>
                </Button>
                <Button
                    x:Name="RefreshAllButton"
                    Click="RefreshAllButton_Click">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <SymbolIcon Symbol="Refresh"/>
                        <TextBlock Text="Refresh All Applications"/>
                    </StackPanel>
                </Button>
            </StackPanel>

            <StackPanel HorizontalAlignment="Left" Orientation="Horizontal" Margin="0,10,0,5">
                <TextBlock Text="Currently loaded:" FontWeight="Bold" />
                <TextBlock Text="{x:Bind CurrentLoadedType, Mode=OneWay, FallbackValue=''}" Margin="10,0,0,0" />
            </StackPanel>
        </StackPanel>

        <StackPanel 
            Grid.Row="1"
            Orientation="Vertical"
            Spacing="4">

            <Grid RowDefinitions="Auto,*" >

                <ProgressRing
                    Grid.Row="1"
                    x:Name="RefreshProgress"
                    IsActive="True"
                    Canvas.ZIndex="999"
                    Height="100"
                    Width="100" />

                <StackPanel Grid.Row="0" Orientation="Vertical">
                    <StackPanel HorizontalAlignment="Left" Orientation="Horizontal" Spacing="0">
                        <TextBox Width="300" Text="{x:Bind SearchAppId, Mode=TwoWay, FallbackValue=''}" />
                        <TextBox Width="300" Text="{x:Bind SearchDisplayName, Mode=TwoWay, FallbackValue=''}" />
                        <TextBox Width="300" Text="{x:Bind SearchObjectId, Mode=TwoWay, FallbackValue=''}" />
                        <TextBox Width="300" Text="{x:Bind SearchEnterpriseApplicationId, Mode=TwoWay, FallbackValue=''}" />
                        <Button
                            Click="SearchButton_Click">
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <SymbolIcon Symbol="Find"/>
                            </StackPanel>
                        </Button>
                        <Button
                            Click="ClearSearchButton_Click">
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <SymbolIcon Symbol="Clear"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>

                <controls:DataGrid 
                    Grid.Row="1"
                    x:Name="ApplicationsGrid"
                    Height="600"
                    AutoGenerateColumns="False"
                    CanUserSortColumns="True"
                    IsReadOnly="True"
                    IsTapEnabled="True"
                    ItemsSource="{x:Bind AppRegInfos, Mode=OneWay}"
                    SelectionMode="Single"
                    SelectionChanged="ApplicationsGrid_OnSelectionChanged"
                    Sorting="ApplicationsGrid_Sorting"
                    Margin="0,10,0,10">

                    <controls:DataGrid.Resources>
                        <Style x:Key="GuidColumnStyle" TargetType="TextBlock">
                            <Setter Property="FontFamily" Value="Consolas" />
                            <Setter Property="FontSize" Value="14" />
                        </Style>
                    </controls:DataGrid.Resources>

                    <controls:DataGrid.Columns>
                        <controls:DataGridTextColumn
                            ElementStyle="{StaticResource GuidColumnStyle}"
                            Header="Application (client) ID"
                            Binding="{Binding AppId}"
                            Width="300"
                            CanUserSort="True"
                            Tag="AppId" />
                        <controls:DataGridTextColumn
                            Header="Display Name"
                            Binding="{Binding DisplayName}"
                            Width="300"
                            CanUserSort="True"
                            Tag="DisplayName" />
                        <controls:DataGridTextColumn
                            ElementStyle="{StaticResource GuidColumnStyle}"
                            Header="Object ID"
                            Binding="{Binding ObjectId}"
                            Width="300"
                            CanUserSort="True"
                            Tag="ObjectId" />
                        <controls:DataGridTextColumn
                            ElementStyle="{StaticResource GuidColumnStyle}"
                            Header="Enterprise Application Object ID"
                            Binding="{Binding EnterpriseApplication.Id, FallbackValue=''}"
                            Width="300"
                            CanUserSort="True"
                            Tag="Enterprise Application Object ID" />
                        <controls:DataGridTextColumn
                            Header="Editable?"
                            Binding="{Binding CanEdit}"
                            Width="80"
                            CanUserSort="True"
                            Tag="CanEdit" />
                    </controls:DataGrid.Columns>
                </controls:DataGrid>
            </Grid>
        </StackPanel>

        <StackPanel Grid.Row="2"
                    Orientation="Vertical"
                    Spacing="4">

            <Grid RowDefinitions="Auto,*" >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="3*" />
                    <ColumnDefinition Width="2*" />
                </Grid.ColumnDefinitions>

                <ProgressRing Grid.Row="2"
                              Grid.Column="0"
                              x:Name="RefreshAppProgress"
                              IsActive="False"
                              Canvas.ZIndex="999"
                              Height="100"
                              Width="100" />

                <TabView Grid.Row="2" Grid.Column="0" VerticalAlignment="Stretch" IsAddTabButtonVisible="False">
                    <TabViewItem Header="Overview" IsClosable="False" >
                        <TabViewItem.IconSource>
                            <SymbolIconSource Symbol="View" />
                        </TabViewItem.IconSource>
                        <TabViewItem.Content>
                            <features_overview:OverviewUserControl AppRegInfo="{x:Bind AppRegInfo, Mode=TwoWay}" CanEdit="{x:Bind CanEdit, Mode=OneWay}" />
                        </TabViewItem.Content>
                    </TabViewItem>

                    <TabViewItem x:Name="AuthenticationTab" Header="Authentication" IsClosable="False">
                        <TabViewItem.IconSource>
                            <SymbolIconSource Symbol="ProtectedDocument" />
                        </TabViewItem.IconSource>
                        <TabViewItem.Content>
                            <features_authentication:AuthenticationUserControl AppRegInfo="{x:Bind AppRegInfo, Mode=TwoWay}" CanEdit="{x:Bind CanEdit, Mode=OneWay}" />
                        </TabViewItem.Content>
                    </TabViewItem>

                    <TabViewItem x:Name="ApiPermissions" Header="API Permissions" IsClosable="False">
                        <TabViewItem.IconSource>
                            <SymbolIconSource Symbol="Setting" />
                        </TabViewItem.IconSource>
                        <TabViewItem.Content>
                            <features_apipermissions:ApiPermissionsUserControl AppRegInfo="{x:Bind AppRegInfo, Mode=TwoWay}" CanEdit="{x:Bind CanEdit, Mode=OneWay}" />
                        </TabViewItem.Content>
                    </TabViewItem>

                    <TabViewItem x:Name="ExposeAnAPI" Header="Expose an API" IsClosable="False">
                        <TabViewItem.IconSource>
                            <SymbolIconSource Symbol="Share" />
                        </TabViewItem.IconSource>
                        <TabViewItem.Content>
                            <features_scope:ScopeUserControl AppRegInfo="{x:Bind AppRegInfo, Mode=TwoWay}" CanEdit="{x:Bind CanEdit, Mode=OneWay}" />
                        </TabViewItem.Content>
                    </TabViewItem>

                    <TabViewItem x:Name="AppRolesTab" Header="App Roles" IsClosable="False">
                        <TabViewItem.IconSource>
                            <SymbolIconSource Symbol="Admin" />
                        </TabViewItem.IconSource>
                        <TabViewItem.Content>
                            <features_role:AppRoleUserControl AppRegInfo="{x:Bind AppRegInfo, Mode=TwoWay}" CanEdit="{x:Bind CanEdit, Mode=OneWay}" />
                        </TabViewItem.Content>
                    </TabViewItem>

                    <TabViewItem x:Name="CertificatesAndSecretsTab" Header="Certificates &amp; Secrets" IsClosable="False">
                        <TabViewItem.IconSource>
                            <SymbolIconSource Symbol="Permissions" />
                        </TabViewItem.IconSource>
                        <TabViewItem.Content>
                            <features_CertificatesAndSecrets:CertificatesAndSecretsUserControl AppRegInfo="{x:Bind AppRegInfo, Mode=TwoWay}" CanEdit="{x:Bind CanEdit, Mode=OneWay}" />
                        </TabViewItem.Content>
                    </TabViewItem>

                    <TabViewItem x:Name="OwnersTab" Header="Owners" IsClosable="False">
                        <TabViewItem.IconSource>
                            <SymbolIconSource Symbol="People" />
                        </TabViewItem.IconSource>
                        <TabViewItem.Content>
                            <features_Owners:OwnersUserControl AppRegInfo="{x:Bind AppRegInfo, Mode=TwoWay}" CanEdit="{x:Bind CanEdit, Mode=OneWay}" />
                        </TabViewItem.Content>
                    </TabViewItem>

                    <TabViewItem x:Name="ManifestTab" Header="Manifest" IsClosable="False">
                        <TabViewItem.IconSource>
                            <SymbolIconSource Symbol="Document" />
                        </TabViewItem.IconSource>
                        <TabViewItem.Content>
                            <features_manifest:ManifestUserControl AppRegInfo="{x:Bind AppRegInfo, Mode=TwoWay}" CanEdit="False" />
                        </TabViewItem.Content>
                    </TabViewItem>
                </TabView>
            </Grid>
        </StackPanel>
    </Grid>
</Window>